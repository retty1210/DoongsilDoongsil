<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AccountMapper">

	<!-- 학생,교사 로그인 -->
	<select id="stLoginSelect" parameterType="login" resultType="staccount">
		SELECT * FROM ST_ACCOUNT
		 WHERE STA_USERNAME = #{username} 
		   AND STA_PASSWORD = #{password}
	</select>
	<!-- 학부모 로그인 -->
	<select id="pLoginSelect" parameterType="login" resultType="paaccount">
		SELECT PAA_ID,
			   PAA_USERNAME,
			   PAA_PASSWORD,
			   PAA_PHONENUMBER,
			   B.STA_NAME 
		  FROM PARENTS_ACCOUNT A
		  JOIN ST_ACCOUNT B ON (A.PAA_CHILD_ID = B.STA_ID)
		 WHERE PAA_USERNAME = #{username} 
		   AND PAA_PASSWORD = #{password}
	</select>
	<!-- 교사용 내정보 페이지에서 학생 목록 불러오기 -->
	<select id="infoStudentList" parameterType="staccount" resultType="staccount">
		SELECT * FROM ST_ACCOUNT
		 WHERE STA_USERTYPE = 'S' 
		   AND STA_GRADE = #{sta_grade}
		   AND STA_CLASS = #{sta_class}
	</select>
	<!-- 교사용 학생 정보수정  목록 불러오기 -->
	<select id="studentUpdate" parameterType="int" resultType="staccount">
		SELECT * FROM ST_ACCOUNT
		 WHERE STA_ID = #{id}
	</select>
	<select id="parentUpdate" parameterType="int" resultType="paaccount">
		SELECT PAA_ID, PAA_PHONENUMBER
		  FROM PARENTS_ACCOUNT
		 WHERE PAA_ID = #{id}
	</select>
	<update id="infoUpdate" parameterType="staccount">
		UPDATE ST_ACCOUNT
		   SET STA_NAME = #{sta_name},
		   	   STA_EMAIL = #{sta_email},
		   	   STA_ADDRESS = #{sta_address},
		   	   STA_PHONENUMBER = #{sta_phonenumber},
		   	   STA_GRADE = #{sta_grade},
		   	   STA_class = #{sta_class},
		   	   STA_BIRTHDAY = #{sta_birthday},
		   	   <if test="sta_profile != null">
		   	   	STA_PROFILE = #{sta_profile},
		   	   </if>
		   	   STA_USERTYPE = #{sta_usertype}
		 WHERE STA_ID = #{sta_id}
	</update>
	<update id="parentInfoUpdate" parameterType="paaccount">
		UPDATE PARENTS_ACCOUNT
		   SET PAA_PHONENUMBER = #{paa_phonenumber}
		   <if test="paa_password != null">
		       ,PAA_PASSWORD = #{paa_password}
		   </if>
		 WHERE PAA_ID = #{paa_id}
	</update>
	<delete id="allDelete" parameterType="int">
		DELETE FROM ST_ACCOUNT
		 WHERE STA_ID = #{id}
	</delete>
	<delete id="selectDelete" parameterType="int">
		DELETE FROM ST_ACCOUNT
		 WHERE STA_ID = #{id}
	</delete>

	<select id="selectLoginAccount" parameterType="login" resultType="staccount">
		SELECT * FROM ST_ACCOUNT
		 WHERE STA_USERNAME = #{sta_username}
		   AND STA_PASSWORD = #{sta_password}
	</select>
	
</mapper>
