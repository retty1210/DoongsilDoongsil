<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HomeworkMapper">

	<select id="selectHWList" resultType="t_homework">
		SELECT * FROM T_HOMEWORK ORDER BY THO_ID DESC
	</select>
	
	<select id="selectOneHW" parameterType="t_homework" resultType="t_homework">
		SELECT * FROM T_HOMEWORK
		<where>
			<choose>
				<when test="tho_id != 0">
					THO_ID = #{tho_id}
				</when>
				<when test="tho_id == 0">
					
					THO_WRITER = #{tho_writer} AND
					THO_GRADE = #{tho_grade} AND
					THO_CLASS = #{tho_class} AND
					THO_TITLE = #{tho_title} AND
					THO_CONTENTS = #{tho_contents} AND
					THO_HOMEWORKTYPE = #{tho_homeworktype} AND
					THO_WRITEDATE = #{tho_writedate}
					
				</when>
			</choose>	
		</where>
	</select>
	
	<select id="selectSHList" parameterType="s_homework" resultType="s_homework">
		SELECT * FROM S_HOMEWORK
		WHERE
		SHO_TID = #{sho_tid}
		ORDER BY SHO_ID DESC
	</select>
	
	<select id="selectOneSH" parameterType="s_homework" resultType="s_homework">
		SELECT * FROM S_HOMEWORK
		<where>
			<choose>
				<when test="sho_id != 0">
					SHO_ID = #{sho_id}
				</when>
				<when test="sho_id == 0">
					
					SHO_TID = #{sho_tid} AND
					SHO_WRITER = #{sho_writer} AND
					SHO_HOMEWORKTYPE = #{sho_homeworktype} AND
					SHO_GRADE = #{sho_grade} AND
					SHO_CLASS = #{sho_class} AND
					SHO_CONTENTS = #{sho_contents} AND
					SHO_DATE = #{sho_date}
					
				</when>
				<otherwise>
					1 = 1
				</otherwise>
			</choose>
		</where>
	</select>
	
	<insert id="insertHW" parameterType="t_homework">
		INSERT INTO T_HOMEWORK
		<choose>
			<when test="tho_deadline == null and tho_filelink == null">
				(
					THO_ID,
					THO_WRITER,
					THO_GRADE,
					THO_CLASS,
					THO_TITLE,
					THO_CONTENTS,
					THO_HOMEWORKTYPE,
					THO_WRITEDATE,
					THO_COUNT
				) VALUES (
					T_HOMEWORK_SEQ.NEXTVAL,
					#{tho_writer},
					#{tho_grade},
					#{tho_class},
					#{tho_title},
					#{tho_contents},
					#{tho_homeworktype},
					#{tho_writedate},
					#{tho_count}
				)
			</when>
			<when test="tho_deadline != null and tho_filelink == null">
				(
					THO_ID,
					THO_WRITER,
					THO_GRADE,
					THO_CLASS,
					THO_TITLE,
					THO_CONTENTS,
					THO_HOMEWORKTYPE,
					THO_WRITEDATE,
					THO_DEADLINE,
					THO_COUNT
				) VALUES (
					T_HOMEWORK_SEQ.NEXTVAL,
					#{tho_writer},
					#{tho_grade},
					#{tho_class},
					#{tho_title},
					#{tho_contents},
					#{tho_homeworktype},
					#{tho_writedate},
					#{tho_deadline},
					#{tho_count}
				)
			</when>
			<when test="tho_deadline == null and tho_filelink != null">
				(
					THO_ID,
					THO_WRITER,
					THO_GRADE,
					THO_CLASS,
					THO_TITLE,
					THO_CONTENTS,
					THO_HOMEWORKTYPE,
					THO_WRITEDATE,
					THO_FILELINK,
					THO_COUNT
				) VALUES (
					T_HOMEWORK_SEQ.NEXTVAL,
					#{tho_writer},
					#{tho_grade},
					#{tho_class},
					#{tho_title},
					#{tho_contents},
					#{tho_homeworktype},
					#{tho_writedate},
					#{tho_filelink},
					#{tho_count}
				)
			</when>
			<otherwise>
				VALUES(
					T_HOMEWORK_SEQ.NEXTVAL,
					#{tho_writer},
					#{tho_grade},
					#{tho_class},
					#{tho_title},
					#{tho_contents},
					#{tho_homeworktype},
					#{tho_writedate},
					#{tho_deadline},
					#{tho_filelink},
					#{tho_count}
				)
			</otherwise>
		</choose>
	</insert>
	
	<insert id="insertSH" parameterType="s_homework">
		INSERT INTO S_HOMEWORK(
			SHO_ID,
			SHO_TID,
			SHO_WRITER,
			SHO_HOMEWORKTYPE,
			SHO_GRADE,
			SHO_CLASS,
			SHO_CONTENTS,
			SHO_DATE
			<if test="sho_fileurl != null">
				,
				SHO_FILEURL
			</if>
		) VALUES (
			S_HOMEWORK_SEQ.NEXTVAL,
			#{sho_tid},
			#{sho_writer},
			#{sho_homeworktype},
			#{sho_grade},
			#{sho_class},
			#{sho_contents},
			#{sho_date}
			<if test="sho_fileurl != null">
				,
				#{sho_fileurl}
			</if>
		)
	</insert>
	
	<delete id="deleteHW" parameterType="t_homework">
		DELETE FROM T_HOMEWORK
			WHERE THO_ID = #{tho_id}
	</delete>
	
	<delete id="deleteSH" parameterType="s_homework">
		DELETE FROM S_HOMEWORK
			WHERE SHO_ID = #{sho_id}
	</delete>
	
	<update id="updateSHGoodbad" parameterType="s_homework">
		UPDATE S_HOMEWORK
			<set>
				<if test="sho_comment != null">
					SHO_COMMENT = #{sho_comment} AND
				</if>
				SHO_GOODBAD = #{sho_goodbad}
			</set>
			WHERE SHO_ID = #{sho_id}	
	</update>
	
	<update id="updateTHCount" parameterType="t_homework">
		UPDATE T_HOMEWORK SET THO_COUNT = #{tho_count} WHERE THO_ID = #{tho_id}
	</update>
	
	<select id="selectTHOCategory" resultType="tho_category">
		SELECT * FROM THO_CATEGORY ORDER BY TCA_ID
	</select>
	
</mapper>